# 数据库设计 - 贷款体检器v1.0

**项目名称**：企业贷款体质改造系统  
**产品名称**：贷款体检器 v1.0  
**数据库类型**：MySQL 8.0+  
**更新日期**：2024-12-07

---

## 一、数据库概述

### 设计原则
- **规范化**：遵循第三范式，避免数据冗余
- **性能优化**：合理设计索引，提升查询效率
- **扩展性**：预留扩展字段，支持未来需求
- **安全性**：敏感信息加密，访问权限控制

### 数据库命名规范
- 数据库名：`loan_diagnosis_system`
- 表名：小写 + 下划线（如 `bank_products`）
- 字段名：小写 + 下划线（如 `created_at`）
- 索引名：`idx_` + 表名 + 字段名（如 `idx_users_mobile`）
- 主键名：`id`（自增）
- 外键名：`fk_` + 表名 + 字段名

---

## 二、核心表设计

### 2.1 用户表（users）

**用途**：存储企业用户基本信息

```sql
CREATE TABLE `users` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `mobile` varchar(11) NOT NULL COMMENT '手机号（登录账号）',
  `password` varchar(255) DEFAULT NULL COMMENT '密码（加密存储）',
  `enterprise_name` varchar(100) DEFAULT NULL COMMENT '企业名称',
  `legal_person` varchar(50) DEFAULT NULL COMMENT '法人姓名',
  `uscc` varchar(18) DEFAULT NULL COMMENT '统一社会信用代码',
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态：1-正常，0-禁用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_mobile` (`mobile`),
  KEY `idx_uscc` (`uscc`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

**字段说明**：
- `mobile`：手机号，唯一索引，用于登录
- `password`：密码，使用bcrypt加密
- `uscc`：统一社会信用代码，企业唯一标识
- `status`：账号状态，支持禁用功能

---

### 2.2 诊断问卷表（diagnosis_questionnaires）

**用途**：存储用户填写的诊断问卷答案

```sql
CREATE TABLE `diagnosis_questionnaires` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '问卷ID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT '用户ID',
  `enterprise_name` varchar(100) NOT NULL COMMENT '企业名称',
  `industry` varchar(50) NOT NULL COMMENT '所属行业',
  `establishment_years` int(11) NOT NULL COMMENT '成立年限',
  `annual_revenue` decimal(15,2) DEFAULT NULL COMMENT '年营收（万元）',
  `annual_invoice` decimal(15,2) DEFAULT NULL COMMENT '年开票额（万元）',
  `annual_tax` decimal(15,2) DEFAULT NULL COMMENT '年纳税额（万元）',
  `tax_grade` varchar(10) DEFAULT NULL COMMENT '纳税信用等级：A/B/M/C/D',
  `has_property` tinyint(1) DEFAULT '0' COMMENT '是否有房产：1-是，0-否',
  `property_value` decimal(15,2) DEFAULT NULL COMMENT '房产评估值（万元）',
  `has_patent` tinyint(1) DEFAULT '0' COMMENT '是否有专利：1-是，0-否',
  `patent_count` int(11) DEFAULT '0' COMMENT '专利数量',
  `is_high_tech` tinyint(1) DEFAULT '0' COMMENT '是否高新企业：1-是，0-否',
  `credit_status` varchar(20) DEFAULT NULL COMMENT '征信状况：良好/一般/较差',
  `target_amount` decimal(15,2) NOT NULL COMMENT '目标贷款额（万元）',
  `target_term` int(11) DEFAULT NULL COMMENT '目标期限（月）',
  `urgency` varchar(20) DEFAULT NULL COMMENT '紧急程度：紧急/一般/不急',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_questionnaires_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='诊断问卷表';
```

**字段说明**：
- 字段对应诊断问卷的15道题
- `decimal(15,2)`：金额字段，保留2位小数
- 外键关联用户表，用户删除时级联删除问卷

---

### 2.3 诊断报告表（diagnosis_reports）

**用途**：存储生成的诊断报告

```sql
CREATE TABLE `diagnosis_reports` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '报告ID',
  `user_id` bigint(20) unsigned NOT NULL COMMENT '用户ID',
  `questionnaire_id` bigint(20) unsigned NOT NULL COMMENT '问卷ID',
  `report_no` varchar(32) NOT NULL COMMENT '报告编号',
  
  -- 当前状况
  `current_max_amount` decimal(15,2) DEFAULT '0.00' COMMENT '当前最大可贷额度（万元）',
  `current_products_count` int(11) DEFAULT '0' COMMENT '当前匹配产品数量',
  `current_best_rate` decimal(5,2) DEFAULT NULL COMMENT '当前最优利率（%）',
  
  -- 目标状况
  `target_amount` decimal(15,2) NOT NULL COMMENT '目标贷款额（万元）',
  `gap_amount` decimal(15,2) DEFAULT '0.00' COMMENT '差距额度（万元）',
  
  -- 改造方案
  `has_solution` tinyint(1) DEFAULT '0' COMMENT '是否有改造方案：1-是，0-否',
  `solution_type` varchar(50) DEFAULT NULL COMMENT '方案类型：fastest/cheapest/best',
  `solution_cost` decimal(15,2) DEFAULT NULL COMMENT '方案成本（万元）',
  `solution_duration` int(11) DEFAULT NULL COMMENT '方案周期（月）',
  `solution_roi` decimal(10,2) DEFAULT NULL COMMENT 'ROI（%）',
  
  -- 报告状态
  `status` varchar(20) NOT NULL DEFAULT 'generated' COMMENT '状态：generated/viewed/downloaded',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_report_no` (`report_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_questionnaire_id` (`questionnaire_id`),
  KEY `idx_created_at` (`created_at`),
  CONSTRAINT `fk_reports_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_reports_questionnaire_id` FOREIGN KEY (`questionnaire_id`) REFERENCES `diagnosis_questionnaires` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='诊断报告表';
```

**字段说明**：
- `report_no`：报告编号，格式如 `DIAG20241207XXXXXX`
- 包含当前状况、目标状况、改造方案等核心数据
- `status`：报告状态，用于统计分析

---

### 2.4 匹配产品表（report_products）

**用途**：存储报告匹配的银行产品（当前+改造后）

```sql
CREATE TABLE `report_products` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `report_id` bigint(20) unsigned NOT NULL COMMENT '报告ID',
  `product_id` bigint(20) unsigned NOT NULL COMMENT '产品ID',
  `match_type` varchar(20) NOT NULL COMMENT '匹配类型：current/after_reform',
  `match_score` int(11) DEFAULT NULL COMMENT '匹配分数（0-100）',
  `estimated_amount` decimal(15,2) DEFAULT NULL COMMENT '预估额度（万元）',
  `estimated_rate` decimal(5,2) DEFAULT NULL COMMENT '预估利率（%）',
  `is_recommended` tinyint(1) DEFAULT '0' COMMENT '是否推荐：1-是，0-否',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_report_id` (`report_id`),
  KEY `idx_product_id` (`product_id`),
  CONSTRAINT `fk_report_products_report_id` FOREIGN KEY (`report_id`) REFERENCES `diagnosis_reports` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_report_products_product_id` FOREIGN KEY (`product_id`) REFERENCES `bank_products` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报告匹配产品表';
```

**字段说明**：
- `match_type`：区分当前匹配和改造后匹配
- `match_score`：匹配度评分，用于排序
- `is_recommended`：是否推荐给用户

---

### 2.5 改造方案表（report_solutions）

**用途**：存储报告推荐的改造方案

```sql
CREATE TABLE `report_solutions` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',
  `report_id` bigint(20) unsigned NOT NULL COMMENT '报告ID',
  `solution_id` bigint(20) unsigned NOT NULL COMMENT '方案ID',
  `priority` int(11) DEFAULT NULL COMMENT '优先级：1-最快，2-最省，3-最大',
  `cost` decimal(15,2) DEFAULT NULL COMMENT '成本（万元）',
  `duration` int(11) DEFAULT NULL COMMENT '周期（月）',
  `expected_amount` decimal(15,2) DEFAULT NULL COMMENT '预期额度（万元）',
  `roi` decimal(10,2) DEFAULT NULL COMMENT 'ROI（%）',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_report_id` (`report_id`),
  KEY `idx_solution_id` (`solution_id`),
  CONSTRAINT `fk_report_solutions_report_id` FOREIGN KEY (`report_id`) REFERENCES `diagnosis_reports` (`id`) ON DELETE CASCADE,
  CONSTRAINT `fk_report_solutions_solution_id` FOREIGN KEY (`solution_id`) REFERENCES `reform_solutions` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='报告改造方案表';
```

---

## 三、基础数据表

### 3.1 银行产品表（bank_products）

**用途**：存储银行贷款产品信息

```sql
CREATE TABLE `bank_products` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '产品ID',
  `product_name` varchar(100) NOT NULL COMMENT '产品名称',
  `bank_name` varchar(50) NOT NULL COMMENT '银行名称',
  `product_type` varchar(50) NOT NULL COMMENT '产品类型：发票贷/税贷/抵押贷等',
  
  -- 额度信息
  `max_amount` decimal(15,2) DEFAULT NULL COMMENT '最高额度（万元）',
  `min_amount` decimal(15,2) DEFAULT NULL COMMENT '最低额度（万元）',
  `amount_formula` text COMMENT '额度计算公式',
  
  -- 利率信息
  `min_rate` decimal(5,2) DEFAULT NULL COMMENT '最低利率（%）',
  `max_rate` decimal(5,2) DEFAULT NULL COMMENT '最高利率（%）',
  
  -- 准入条件（JSON格式）
  `requirements` json DEFAULT NULL COMMENT '准入条件',
  
  -- 其他信息
  `term` varchar(50) DEFAULT NULL COMMENT '期限',
  `repayment_method` varchar(100) DEFAULT NULL COMMENT '还款方式',
  `approval_duration` varchar(50) DEFAULT NULL COMMENT '审批时长',
  
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-停用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_product_type` (`product_type`),
  KEY `idx_bank_name` (`bank_name`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='银行产品表';
```

**requirements字段示例（JSON）**：
```json
{
  "establishment_years": {"min": 1},
  "annual_invoice": {"min": 50},
  "annual_tax": {"min": 5},
  "tax_grade": ["A", "B"],
  "credit_status": ["良好"],
  "industry_blacklist": ["房地产", "金融"]
}
```

---

### 3.2 改造方案表（reform_solutions）

**用途**：存储改造方案信息

```sql
CREATE TABLE `reform_solutions` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '方案ID',
  `solution_name` varchar(100) NOT NULL COMMENT '方案名称',
  `solution_category` varchar(50) NOT NULL COMMENT '方案分类',
  
  -- 适用场景
  `applicable_condition` text COMMENT '适用条件',
  
  -- 成本周期
  `min_cost` decimal(15,2) DEFAULT NULL COMMENT '最低成本（万元）',
  `max_cost` decimal(15,2) DEFAULT NULL COMMENT '最高成本（万元）',
  `min_duration` int(11) DEFAULT NULL COMMENT '最短周期（月）',
  `max_duration` int(11) DEFAULT NULL COMMENT '最长周期（月）',
  
  -- 方案详情
  `solution_detail` text COMMENT '方案详情',
  `steps` json DEFAULT NULL COMMENT '执行步骤（JSON）',
  
  `status` tinyint(1) NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-停用',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_solution_category` (`solution_category`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='改造方案表';
```

---

### 3.3 案例库表（case_studies）

**用途**：存储成功案例

```sql
CREATE TABLE `case_studies` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '案例ID',
  `case_title` varchar(200) NOT NULL COMMENT '案例标题',
  `industry` varchar(50) DEFAULT NULL COMMENT '行业',
  `enterprise_type` varchar(50) DEFAULT NULL COMMENT '企业类型',
  
  -- 改造前
  `before_amount` decimal(15,2) DEFAULT NULL COMMENT '改造前额度（万元）',
  `before_rate` decimal(5,2) DEFAULT NULL COMMENT '改造前利率（%）',
  
  -- 改造后
  `after_amount` decimal(15,2) DEFAULT NULL COMMENT '改造后额度（万元）',
  `after_rate` decimal(5,2) DEFAULT NULL COMMENT '改造后利率（%）',
  
  -- 改造过程
  `solution_used` varchar(100) DEFAULT NULL COMMENT '使用的方案',
  `cost` decimal(15,2) DEFAULT NULL COMMENT '投入成本（万元）',
  `duration` int(11) DEFAULT NULL COMMENT '改造周期（月）',
  `roi` decimal(10,2) DEFAULT NULL COMMENT 'ROI（%）',
  
  `case_content` text COMMENT '案例详情',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_industry` (`industry`),
  KEY `idx_solution_used` (`solution_used`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='案例库表';
```

---

## 四、系统表

### 4.1 操作日志表（operation_logs）

**用途**：记录用户操作日志

```sql
CREATE TABLE `operation_logs` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` bigint(20) unsigned DEFAULT NULL COMMENT '用户ID',
  `operation_type` varchar(50) NOT NULL COMMENT '操作类型',
  `operation_desc` varchar(255) DEFAULT NULL COMMENT '操作描述',
  `request_data` text COMMENT '请求数据',
  `response_data` text COMMENT '响应数据',
  `ip_address` varchar(50) DEFAULT NULL COMMENT 'IP地址',
  `user_agent` varchar(255) DEFAULT NULL COMMENT '用户代理',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_operation_type` (`operation_type`),
  KEY `idx_created_at` (`created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作日志表';
```

---

### 4.2 系统配置表（system_configs）

**用途**：存储系统配置

```sql
CREATE TABLE `system_configs` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `config_key` varchar(100) NOT NULL COMMENT '配置键',
  `config_value` text COMMENT '配置值',
  `config_desc` varchar(255) DEFAULT NULL COMMENT '配置描述',
  `created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_config_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

**配置示例**：
```sql
INSERT INTO system_configs (config_key, config_value, config_desc) VALUES
('sms_template_login', '您的验证码是{code}，5分钟内有效', '登录短信模板'),
('report_expire_days', '30', '报告有效期（天）'),
('max_free_reports', '3', '免费报告次数');
```

---

## 五、索引策略

### 5.1 主要查询场景

**场景1：用户登录**
```sql
SELECT * FROM users WHERE mobile = ? AND status = 1;
```
索引：`uk_mobile`（已创建）

**场景2：查询用户的诊断报告**
```sql
SELECT * FROM diagnosis_reports WHERE user_id = ? ORDER BY created_at DESC;
```
索引：`idx_user_id`, `idx_created_at`（已创建）

**场景3：匹配银行产品**
```sql
SELECT * FROM bank_products 
WHERE product_type = ? AND status = 1;
```
索引：`idx_product_type`, `idx_status`（已创建）

**场景4：查询报告的匹配产品**
```sql
SELECT rp.*, bp.* 
FROM report_products rp
JOIN bank_products bp ON rp.product_id = bp.id
WHERE rp.report_id = ?;
```
索引：`idx_report_id`（已创建）

---

### 5.2 复合索引建议

**建议1：诊断问卷的业务查询**
```sql
ALTER TABLE diagnosis_questionnaires 
ADD INDEX `idx_user_created` (`user_id`, `created_at`);
```

**建议2：银行产品的组合筛选**
```sql
ALTER TABLE bank_products 
ADD INDEX `idx_type_bank_status` (`product_type`, `bank_name`, `status`);
```

---

## 六、数据初始化

### 6.1 银行产品数据

```sql
-- 示例：建设银行-云税贷
INSERT INTO bank_products (
  product_name, bank_name, product_type,
  max_amount, min_amount, amount_formula,
  min_rate, max_rate,
  requirements,
  term, repayment_method, approval_duration,
  status
) VALUES (
  '云税贷', '建设银行', '税贷',
  500, 1, '年纳税额 × 倍数（A级20倍，B级15倍，M级10倍）',
  3.15, 6.00,
  '{"establishment_years":{"min":1},"annual_tax":{"min":5},"tax_grade":["A","B","M"],"credit_status":["良好"]}',
  '12个月', '随借随还', '最快当天，一般3-5天',
  1
);
```

---

### 6.2 改造方案数据

```sql
-- 示例：开票提升术
INSERT INTO reform_solutions (
  solution_name, solution_category,
  applicable_condition,
  min_cost, max_cost, min_duration, max_duration,
  solution_detail,
  status
) VALUES (
  '开票提升术', '开票提升',
  '年开票额<年营收80%的企业',
  8, 15, 4, 7,
  '通过H业务帮助企业提升开票额，从而提升发票贷额度',
  1
);
```

---

## 七、数据安全

### 7.1 敏感数据加密

**需要加密的字段**：
- `users.password`：bcrypt加密
- `users.mobile`：AES加密（可选，用于防止泄露）
- `diagnosis_questionnaires`中的财务数据：视安全等级决定

**加密示例（应用层）**：
```python
# Python示例
import bcrypt

# 密码加密
password = "user_password"
hashed = bcrypt.hashpw(password.encode('utf-8'), bcrypt.gensalt())

# 密码验证
bcrypt.checkpw(password.encode('utf-8'), hashed)
```

---

### 7.2 数据备份策略

**备份方案**：
1. **每日全量备份**：凌晨2点自动备份
2. **实时增量备份**：开启binlog
3. **异地备份**：备份文件存储到OSS
4. **保留策略**：保留最近30天的备份

**备份脚本**：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d)
mysqldump -u root -p loan_diagnosis_system > backup_${DATE}.sql
# 上传到OSS或其他存储
```

---

## 八、性能优化建议

### 8.1 分表策略

**当数据量>1000万时，考虑分表**：

**诊断报告表分表（按月）**：
```sql
CREATE TABLE `diagnosis_reports_202401` LIKE `diagnosis_reports`;
CREATE TABLE `diagnosis_reports_202402` LIKE `diagnosis_reports`;
-- ...
```

**操作日志表分表（按月）**：
```sql
CREATE TABLE `operation_logs_202401` LIKE `operation_logs`;
-- ...
```

---

### 8.2 缓存策略

**Redis缓存方案**：

**1. 银行产品列表（1小时）**
```
Key: bank_products:all
Value: JSON array
TTL: 3600秒
```

**2. 用户信息（30分钟）**
```
Key: user:info:{user_id}
Value: JSON object
TTL: 1800秒
```

**3. 诊断报告（10分钟）**
```
Key: report:{report_id}
Value: JSON object
TTL: 600秒
```

---

## 九、ER图

```
┌─────────────┐       ┌────────────────────────┐       ┌─────────────────┐
│   users     │1    N │diagnosis_questionnaires│1    1 │diagnosis_reports│
│             ├───────┤                        ├───────┤                 │
│ - id        │       │ - id                   │       │ - id            │
│ - mobile    │       │ - user_id (FK)         │       │ - questionnaire │
│ - password  │       │ - enterprise_name      │       │ - report_no     │
│ - ...       │       │ - annual_revenue       │       │ - current_max   │
└─────────────┘       │ - annual_invoice       │       │ - target_amount │
                      │ - ...                  │       │ - ...           │
                      └────────────────────────┘       └────────┬────────┘
                                                                │1
                                                                │
                                                                │N
                      ┌────────────────┐                ┌──────┴─────────┐
                      │ bank_products  │1             N │report_products │
                      │                ├────────────────┤                │
                      │ - id           │                │ - id           │
                      │ - product_name │                │ - report_id(FK)│
                      │ - bank_name    │                │ - product_id   │
                      │ - ...          │                │ - match_type   │
                      └────────────────┘                └────────────────┘
                      
                      ┌─────────────────┐               ┌────────────────┐
                      │reform_solutions │1            N │report_solutions│
                      │                 ├───────────────┤                │
                      │ - id            │               │ - id           │
                      │ - solution_name │               │ - report_id(FK)│
                      │ - ...           │               │ - solution_id  │
                      └─────────────────┘               └────────────────┘
```

---

## 十、版本管理

**数据库版本控制建议**：

使用数据库迁移工具（如Flyway、Liquibase）管理版本：

**V1__init_tables.sql**：
```sql
-- 创建所有表
CREATE TABLE users (...);
CREATE TABLE diagnosis_questionnaires (...);
-- ...
```

**V2__add_solution_fields.sql**：
```sql
-- 添加新字段
ALTER TABLE diagnosis_reports ADD COLUMN solution_detail TEXT;
```

---

## 十一、附录

### 11.1 常用SQL

**查询用户最新报告**：
```sql
SELECT dr.*, dq.enterprise_name 
FROM diagnosis_reports dr
JOIN diagnosis_questionnaires dq ON dr.questionnaire_id = dq.id
WHERE dr.user_id = ?
ORDER BY dr.created_at DESC
LIMIT 1;
```

**统计每日新增报告数**：
```sql
SELECT DATE(created_at) as date, COUNT(*) as count
FROM diagnosis_reports
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY DATE(created_at)
ORDER BY date DESC;
```

**查询高匹配度产品**：
```sql
SELECT bp.*, rp.match_score, rp.estimated_amount
FROM report_products rp
JOIN bank_products bp ON rp.product_id = bp.id
WHERE rp.report_id = ? AND rp.match_score >= 80
ORDER BY rp.match_score DESC;
```

---

**设计者**：Claude AI  
**审核者**：开发团队  
**版本**：v1.0  
**最后更新**：2024-12-07

---

*本数据库设计文档作为开发指导，实际实施时可根据具体需求调整。*
